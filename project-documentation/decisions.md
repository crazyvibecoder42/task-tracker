# Decisions

- 2026-02-10: For this review, we assume the backend runs in Docker. Under that assumption, using `UPLOAD_DIR = /app/uploads` is acceptable. The concern about `/app` not existing only applies to non-Docker local runs, so the upload path decision is considered low severity for this environment.
- 2026-02-10: SVG uploads are not allowed. Rationale: prevent XSS risk from inline/active content in SVGs. Frontend should not advertise `.svg` in file input accept lists.
- 2026-02-10: Content-Length required for security.
- 2026-02-11: [review-reconciler] Accepted pushback on API key auth O(n) hash verification cost. Guidance: do not flag this as an active defect at current scale; treat as a follow-up only when key volume or latency data indicates pressure. Scope: `backend/auth/dependencies.py` API key authentication path.
- 2026-02-11: Migration scripts are temporarily out of scope for active code reviews. Guidance: do not raise findings against files under `backend/migrations/` until this decision is revisited.
- 2026-02-11: [review-reconciler] Accepted pushback on per-request `last_login_at` / `last_used_at` timestamp commits. Guidance: do not flag auth-path timestamp writes as an active defect at current scale; revisit only with observed DB contention/latency signals. Scope: `backend/auth/dependencies.py` authentication dependency commit path.
- 2026-02-11: [review-reconciler] Accepted pushback on cookie-presence-only Next.js middleware gating. Guidance: do not flag middleware checks based on refresh-cookie presence (without token validity verification) as an active defect for this app architecture; client-side `AuthContext` handles token validation and redirect on auth failure. Scope: `frontend/middleware.ts` with `frontend/contexts/AuthContext.tsx` coordination.
- 2026-02-11: [review-reconciler] Accepted pushback on Uvicorn request-size flag removal. Guidance: do not flag removal of `--limit-max-request-size` as a regression; enforce upload size via application-level validation (`Content-Length` precheck + streaming byte count). Scope: `docker-compose.yml` backend command and `backend/main.py` upload handlers.
- 2026-02-12: [review-reconciler] Accepted pushback on requiring backward-compatible `ALTER TABLE` changes for `backend/init.sql`. Guidance: do not flag missing incremental DDL for pre-existing databases when reviewing this project; schema authority is fresh initialization from `backend/init.sql` per project deployment model. Scope: schema reviews tied to `CLAUDE.md` fresh-deployment constraints.
- 2026-02-13: [review-reconciler] Accepted pushback on treating missing MCP adapter tests as an active defect at current scale. Guidance: do not flag missing dedicated tests for thin MCP-to-backend passthrough handlers as active defects when backend endpoint coverage and runtime validation already exist; keep as follow-up only if MCP layer logic expands or regressions occur. Scope: `mcp-server/stdio_server.py` tool adapters such as `create_user`.
- 2026-02-13: [review-reconciler] Accepted pushback on treating missing frontend tests for API-key/MCP-setup UI as an active defect at current scale. Guidance: do not flag absent component/integration tests for internal-only settings flows as active defects by default; revisit when the flow becomes external/high-traffic, incident-prone, or business-critical. Scope: `frontend/app/settings/page.tsx` and related components (`frontend/components/ApiKeyModal.tsx`, `frontend/components/ApiKeyListItem.tsx`, `frontend/components/McpConfigGenerator.tsx`).
- 2026-02-26: [review-reconciler] Accepted pushback on applying `done` completion guardrails to `not_needed` transitions. Guidance: do not flag lack of blocker/subtask completion validation for `not_needed` status changes as a defect when `not_needed` is intentionally treated as cancellation/abandonment semantics. Scope: `backend/main.py` single-task and bulk status update validation paths (`update_task`, `bulk_update_tasks`).
- 2026-02-26: [review-reconciler] Accepted pushback on requiring dedicated frontend unit tests for simple `not_needed` overdue semantics. Guidance: do not flag missing standalone frontend tests for trivial pure helpers when backend endpoint tests already validate the same status semantics and no frontend test harness is established. Scope: `frontend/lib/date-utils.ts` `isOverdue` in the current task-status rollout.
- 2026-02-27: [review-reconciler] Accepted pushback on requiring immediate automated tests for newly added, straightforward validation paths at current scale. Guidance: do not flag missing dedicated tests as an active defect when logic mirrors existing validated patterns and manual verification is explicitly used; revisit if validation logic expands or regressions emerge. Scope: backend `subproject_id` same-project checks in task mutation endpoints.
